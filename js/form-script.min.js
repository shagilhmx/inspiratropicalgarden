var responseData;
jQuery(
  (function ($) {
    "use strict";
    $(".bookSiteVisitForm").on("submit", function () {
      $(".bookingStatus").html(
        '<div class="alert alert-warning"><strong>We are Submitting your Details...</strong></div>',
      );
      var form = $(this);
      function fail_func(response) {
        $(".bookingStatus").html(
          '<div class="alert alert-success"><strong>Thank you for Submitting your Details. Our team will get in touch with you shortly.</strong></div>',
        ),
          setTimeout(function () {
            window.location.href = "thankyou.html";
          }, 3e3),
          setTimeout(function () {
            $(".bookingStatus").fadeOut(),
              (window.location.href = "thankyou.html");
          }, 4e3);
      }
      function fail_func01(data) {}
      function done_func(data) {
        $(".bookingStatus").html(
          '<div class="alert alert-danger"><strong>Error while Submitting your Details!</strong></div>',
        ),
          setTimeout(function () {
            //$(".bookSiteVisitForm").trigger("reset");
          }, 3e3),
          setTimeout(function () {
            //$(".bookingStatus").fadeOut(), location.reload();
          }, 4e3);
      }

      let [name, email, phone] = form.serializeArray();
      let body = {},
        utm_source,
        utm_campaign,
        utm_content,
        utm_medium,
        utm_terms;

      let emailRegex =
        /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;
      if (
        email?.value &&
        email?.value?.match(emailRegex) &&
        name?.value &&
        phone?.value
      ) {
        let url = window.location.href;
        let searchParams = new URLSearchParams(new URL(url).search);

        utm_source = searchParams.get("utm_source");
        utm_campaign = searchParams.get("utm_campaign");
        utm_medium = searchParams.get("utm_medium");
        utm_content = searchParams.get("utm_content");
        utm_terms = searchParams.get("utm_terms");

        const check =
          utm_campaign || utm_source || utm_content || utm_medium || utm_terms;

        let metaData = {
          utm_campaign: utm_campaign,
          utm_content: utm_content,
          utm_medium: utm_medium,
          utm_source: utm_source,
          utm_terms: utm_terms,
        };

        body = {
          phone: phone?.value,
          name: name?.value,
          projectId: 24,
          ...(utm_campaign != null && { campaignCode: utm_campaign }),
          email: email?.value,
          requireOtp: isOtp != undefined ? isOtp : false,
          ...(check && {
            metaData: {
              utm_campaign: utm_campaign,
              utm_content: utm_content,
              utm_medium: utm_medium,
              utm_source: utm_source,
              utm_terms: utm_terms,
            },
          }),
        };
      }

      let url = window.location.href;
      const isOtp = new URLSearchParams(new URL(url).search).get("isOtp");

      return (
        $.ajax({
          url: "http://api-dcrm-stage.fincity.in/open/opportunity",
          method: "POST",
          data: JSON.stringify(body),
          contentType: "application/json",
          success: function (data) {
            responseData = data;
          },
        })
          .done(isOtp ? fail_func01 : fail_func)
          .fail(done_func),
        !1
      );
    }),
      $(
        ".downloadBFPForm:not(.downloadBFPForm.otp):not(.downloadBFPForm.location)",
      ).on("submit", function () {
        $(".downloadBFPStatus").fadeIn(),
          $(".downloadBFPStatus").html(
            '<div class="alert alert-warning"><strong>We are Submitting your Details...</strong></div>',
          );
        var form = $(this);
        let [name, email, phone] = form.serializeArray();
        let url = window.location.href;
        const isOtp = new URLSearchParams(new URL(url).search).get("isOtp");
        function fail_func(response) {
          $(".downloadBFPStatus").html(
            '<div class="alert alert-success"><strong>Thank you for Submitting your Details. Your Brochure & Floor Plan are ready to Download</strong></div>',
          ),
            setTimeout(function () {
              $(".downloadBFPForm").trigger("reset");
            }, 4e3),
            setTimeout(function () {
              $(".downloadBFPStatus").fadeOut(),
                $("#downloadBFP").addClass("d-none"),
                $("#downloadBFPSuccess").removeClass("d-none"),
                $("#DownloadFormModalTitle").html(
                  "files are ready to download",
                );
            }, 5e3);
        }
        function fail_func1(response) {
          $(".downloadBFPStatus").html(
            '<div class="alert alert-success"><strong>Thank you for Submitting your Details. Our team will get in touch with you shortly.</strong></div>',
          ),
            setTimeout(function () {
              window.location.href = "thankyou.html";
            }, 3e3),
            setTimeout(function () {
              $(".bookingStatus").fadeOut(),
                (window.location.href = "thankyou.html");
            }, 4e3);
        }
        function done_func(data) {
          $(".downloadBFPStatus").html(
            '<div class="alert alert-danger"><strong>Error while Submitting your Details!</strong></div>',
          ),
            setTimeout(function () {
              //$(".downloadBFPForm").trigger("reset");
            }, 3e3),
            setTimeout(function () {
              //$(".downloadBFPStatus").fadeOut(), location.reload();
            }, 4e3);
        }
        function fail_func1_1(data) {
          setTimeout(function () {
            $("#downloadBFPForm").css("display", "none"),
              $("#otpVerification").css("display", "block"),
              $("#DownloadFormModalTitle").html("Verification Code"),
              $("#numberText").html(
                $("#numberText").text() + ` <strong> ${phone?.value}</strong>`,
              );
            $("#downloadBFPForm").trigger("reset");
          }, 4e3);
        }
        function fail_func_1(data) {}

        let body = {},
          utm_source,
          utm_campaign,
          utm_content,
          utm_medium,
          utm_terms;

        let emailRegex =
          /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;
        if (
          email?.value &&
          email?.value?.match(emailRegex) &&
          name?.value &&
          phone?.value
        ) {
          let url = window.location.href;
          let searchParams = new URLSearchParams(new URL(url).search);

          utm_source = searchParams.get("utm_source");
          utm_campaign = searchParams.get("utm_campaign");
          utm_medium = searchParams.get("utm_medium");
          utm_content = searchParams.get("utm_content");
          utm_terms = searchParams.get("utm_terms");

          const check =
            utm_campaign ||
            utm_source ||
            utm_content ||
            utm_medium ||
            utm_terms;

          body = {
            phone: phone?.value,
            name: name?.value,
            projectId: 24,
            ...(utm_campaign != null && { campaignCode: utm_campaign }),
            email: email?.value,
            requireOtp: isOtp != undefined ? isOtp : false,
            ...(check && {
              metaData: {
                utm_campaign: utm_campaign,
                utm_content: utm_content,
                utm_medium: utm_medium,
                utm_source: utm_source,
                utm_terms: utm_terms,
              },
            }),
          };
        }

        return (
          $.ajax({
            url: "http://api-dcrm-stage.fincity.in/open/opportunity",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify(body),
            success: function (data) {
              responseData = data;
            },
          })
            .done(
              $("#DownloadFormModalTitle:contains('ENQUIRE NOW')")?.length
                ? isOtp
                  ? fail_func1_1
                  : fail_func1
                : isOtp
                ? fail_func_1
                : fail_func,
            )
            .fail(done_func),
          !1
        );
      });
  })(jQuery),
);
