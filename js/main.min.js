document.addEventListener(
  "DOMContentLoaded",
  () => {
    let d = $("body")
        .find("#downloadBFPSuccess")
        .children()
        .children()
        .children("p"),
      e = $("body")
        .find("#downloadBFPSuccess")
        .children()
        .children()
        .children("a"),
      o = setTimeout(() => {
        $("body")
          .addClass("modal-open")
          .find(".modal.fade")
          .addClass("show")
          .removeAttr("aria-hidden")
          .css("display", "block")
          .find(".modal-header")
          .find("h5")
          .text("ENQUIRE NOW");
        let d = $("body").find("#downloadBFPSuccess").children().children();
        d.children("p").remove(), d.children("a").remove();
      }, 1e4);
    $('[data-dismiss="modal"]').on("click", () => {
      $("body")
        .removeClass("modal-open")
        .find(".modal.fade")
        .removeClass("show")
        .attr("aria-hidden", !0)
        .css("display", "none")
        .find(".modal-header")
        .find("h5")
        .text("Submit Your Details to Download Brochure & Floor Plan");
      let n = $("body")
        .find("#downloadBFPSuccess")
        .children()
        .children()
        .children(".text-success");
      $("body").find("#downloadBFPSuccess").children().children().append(n, d),
        $("body")
          .find("#downloadBFPSuccess")
          .children()
          .children()
          .append(n, e),
        $('[data-dismiss="modal"]').off("click"),
        $(".downloadBFPForm").trigger("reset"),
        clearTimeout(o);
    });
  },
  !1,
);

function clickEvent(first, last) {
  if (first.value.length) {
    document.getElementById(last).focus();
  }
}

function moveFocusBack(e, prev) {
  let prevInput = document.getElementById(prev);
  if (
    e.key === "Backspace" &&
    prevInput?.value != null &&
    e?.target?.value == ""
  ) {
    prevInput.focus();
  }
}

const optionLocation = {
  enableHighAccuracy: true,
  timeout: 10000,
  maximumAge: 0,
};

function detectLocation(e) {
  let em = document.querySelector(
    `#${document.querySelector("#locationButton").children[1].id}`,
  );

  em.remove();
  document.getElementById("loading").style.display = "block";

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      (position) => {
        delete responseData?.otp;
        let body = {
          token: responseData?.token,
          locationDto: {
            latitude: position?.coords?.latitude,
            longitude: position?.coords?.longitude,
          },
        };

        axios
          .post(
            `http://api-dcrm-stage.fincity.in/open/opportunity/verify`,
            body,
          )
          .then((res) => {
            document.getElementById("detectText").innerText =
              "Location Detected";
            document.getElementById("loading").style.display = "none";
            document.getElementById("locationButton").style.pointerEvents =
              "none";
          })
          .catch((err) => {});
      },
      (error) => {
        // There was an error retrieving the location
        document.getElementById("detectText").innerText =
          "Failed to fetch Location!";
        document.getElementById("loading").style.display = "none";
      },
      optionLocation,
    );
  } else {
    document.getElementById("loading").style.display = "none";
    document.getElementById("detectText").innerText =
      "Failed to fetch Location!";
  }
}

function backMain(e, check) {
  e.stopPropagation();

  document.getElementById("otpVerification").style.display = "none";
  document.getElementById(
    check ? "downloadBFPForm" : "bookSiteVisitForm",
  ).style.display = "block";
  $(check ? ".downloadBFPStatus" : "bookingStatus").html("");
  document.querySelector("#numberText").innerHTML =
    "Please Enter the Verification Code sent to";
  $(check ? "#DownloadFormModalTitle" : "bookSiteVisitFormTitle").html(
    "ENQUIRE NOW",
  );
}

function resendOtp(e) {
  e.stopPropagation();
  axios
    .post(
      `http://api-dcrm-stage.fincity.in/open/opportunity/send-otp?token=${responseData?.token}`,
    )
    .then((res) => {
      document.querySelector("#resendOtp").innerText = "OTP SENT!";
      responseData = res;
    })
    .catch((err) => {});
}

function verfiyOtp(e) {
  e.stopPropagation();
  delete responseData?.locationDto;
  axios
    .post(
      `http://api-dcrm-stage.fincity.in/open/opportunity/verify`,
      responseData,
    )
    .then((res) => {
      document.getElementById("otpVerification").style.display = "none";
      document.getElementById("location").style.display = "block";
      $("#DownloadFormModalTitle").html("");
    })
    .catch((err) => {});
}
