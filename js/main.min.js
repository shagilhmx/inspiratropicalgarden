document.addEventListener(
  "DOMContentLoaded",
  () => {
    let d = $("body")
        .find("#downloadBFPSuccess")
        .children()
        .children()
        .children("p"),
      e = $("body")
        .find("#downloadBFPSuccess")
        .children()
        .children()
        .children("a"),
      o = setTimeout(() => {
        $("body")
          .addClass("modal-open")
          .find(".modal.fade")
          .addClass("show")
          .removeAttr("aria-hidden")
          .css("display", "block")
          .find(".modal-header")
          .find("h5")
          .text("ENQUIRE NOW");
        let d = $("body").find("#downloadBFPSuccess").children().children();
        d.children("p").remove(), d.children("a").remove();
      }, 1e4);
    $('[data-dismiss="modal"]').on("click", () => {
      $("body")
        .removeClass("modal-open")
        .find(".modal.fade")
        .removeClass("show")
        .attr("aria-hidden", !0)
        .css("display", "none")
        .find(".modal-header")
        .find("h5")
        .text("Submit Your Details to Download Brochure & Floor Plan");
      let n = $("body")
        .find("#downloadBFPSuccess")
        .children()
        .children()
        .children(".text-success");
      $("body").find("#downloadBFPSuccess").children().children().append(n, d),
        $("body")
          .find("#downloadBFPSuccess")
          .children()
          .children()
          .append(n, e),
        $('[data-dismiss="modal"]').off("click"),
        $(".downloadBFPForm").trigger("reset"),
        clearTimeout(o);
    });
  },
  !1,
);

function clickEvent(first, last) {
  if (first.value.length) {
    document.getElementById(last).focus();
  }
}

function moveFocusBack(e, prev) {
  let prevInput = document.getElementById(prev);
  if (e.key === "Backspace" && e.target.value === "" && prevInput != null) {
    prevInput.focus();
  }
}

const optionLocation = {
  enableHighAccuracy: true,
  timeout: 10000,
  maximumAge: 0,
};

function detectLocation(e, check) {
  let em = document.querySelector(
    `#${
      document.querySelector(check ? "#locationButton" : "#locationButton1")
        .children[1].id
    }`,
  );

  em.remove();
  document.getElementById(check ? "loading" : "loading1").style.display =
    "block";

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      (position) => {
        delete responseData?.data?.otp;
        let body = {
          token: responseData?.data?.token,
          locationDto: {
            latitude: position?.coords?.latitude,
            longitude: position?.coords?.longitude,
          },
        };

        axios
          .post(`https://api-dcrm.fincity.com/open/opportunity/verify`, body)
          .then((res) => {
            document.getElementById(
              check ? "detectText" : "detectText1",
            ).innerText = "Location Detected";
            document.getElementById(
              check ? "loading" : "loading1",
            ).style.display = "none";
            document.getElementById(
              check ? "locationButton" : "locationButton1",
            ).style.pointerEvents = "none";
          })
          .catch((err) => {});
      },
      (error) => {
        // There was an error retrieving the location
        document.getElementById(check ? "detectText" : "detectText").innerText =
          "Failed to fetch Location!";
        document.getElementById(check ? "loading" : "loading1").style.display =
          "none";
      },
      optionLocation,
    );
  } else {
    document.getElementById(check ? "loading" : "loading1").style.display =
      "none";
    document.getElementById(check ? "detectText" : "detectText1").innerText =
      "Failed to fetch Location!";
  }
}

function backMain(e, check) {
  e.stopPropagation();

  document.getElementById(
    check ? "otpVerification" : "otpVerification1",
  ).style.display = "none";
  document.getElementById(
    check ? "enquirySubMain" : "enquiryMain",
  ).style.display = "flex";
  document.querySelector(check ? "#numberText" : "#numberText1").innerHTML =
    "Please Enter the Verification Code sent to";
}

function resendOtp(e, check) {
  e.stopPropagation();
  axios
    .post(
      `https://api-dcrm.fincity.com/open/opportunity/send-otp?token=${responseData?.data?.token}`,
    )
    .then((res) => {
      document.querySelector(check ? "#resendOtp" : "#resendOtp1").innerText =
        "OTP SENT!";
      responseData = res;
    })
    .catch((err) => {});
}

function verfiyOtp(e, check) {
  e.stopPropagation();
  delete responseData?.data?.locationDto;
  axios
    .post(
      `https://api-dcrm.fincity.com/open/opportunity/verify`,
      responseData?.data,
    )
    .then((res) => {
      document.getElementById(
        check ? "otpVerification" : "otpVerification1",
      ).style.display = "none";
      document.getElementById(check ? "location" : "location1").style.display =
        "flex";
    })
    .catch((err) => {});
}
